<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to AbilityAssist</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 0;
        }

        footer {
            background-color: #333;
            color: #ffc107;
            text-align: center;
            padding: 20px 0;
        }

        .navbar-brand,
        .nav-link {
            font-family: 'Raleway', sans-serif;
            color: #fff;
        }

        .navbar-dark .navbar-toggler-icon {
            background-color: #fff;
        }

        .navbar-dark .navbar-nav .nav-link {
            color: #fff;
        }

        .navbar-dark .navbar-nav .nav-link:hover {
            color: #ffc107;
        }

        .dropdown-menu {
            font-family: 'Raleway', sans-serif;
            background-color: #333;
        }

        .dropdown-item {
            color: #fff;
        }

        .dropdown-item:hover {
            background-color: #ffc107;
        }

        h2 {
            font-family: 'Montserrat', sans-serif;
            color: #333;
        }

        p {
            font-family: 'Poppins', sans-serif;
            color: #666;
        }

        .form-control {
            border-color: #ffc107;
        }

        .btn-primary {
            background-color: #ffc107;
            border-color: #ffc107;
        }

        .btn-primary:hover {
            background-color: #e0a800;
            border-color: #e0a800;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
            border-color: #c82333;
        }

        .user-icon {
            margin-right: 5px;
        }

        .container {
            margin-top: 20px;
        }

        .split-container {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        #map-container {
            width: 100%;
            height: 400px;
            overflow: hidden;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .form-container {
            width: 100%;
            margin-bottom: 20px;
        }

        .company-info {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: #333;
        }

        footer {
            background-color: #333;
            color: #ffc107;
            text-align: center;
            padding: 20px 0;
        }

        @media (min-width: 768px) {
            .split-container {
                flex-direction: row;
            }

            #map-container {
                width: 60%;
                margin-right: 20px;
            }

            .form-container {
                width: 40%;
            }

        }

        .chat-button {
            margin-top: 10px;
            background-color: #007bff;
            border-color: #007bff;
            color: #fff;
            width:100%;
        }

        .chat-button:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        .emergency-button {
            margin-top: 10px;
            background-color: #dc3545;
            border-color: #dc3545;
            color: #fff;
            width:100%;
        }

        .emergency-button:hover {
            background-color: #c82333;
            border-color: #c82333;
        }

        .button-container {
            margin-top: 10px;
            display:flex;
            flex-direction: column;
            align items: center;
            height: 250px;
        }

        /* Additional styling for buttons */
        .chat-button,
        .emergency-button {
            height: 100%; /* Each button takes up 50% of the height */
            margin-bootm: 10px;
        }

        .chat-button:hover,
        .emergency-button:hover {
            border-radius: 0;
        }

        .chat-button span,
        .emergency-button span {
            display: block;
        }

        .audio-indicator {
        display: none; /* Initially hidden */
        position: absolute;
        top: 20px;
        right: 20px;
        background-color: #007bff;
        color: #fff;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        text-align: center;
        line-height: 40px;
    }

    .audio-indicator.active {
        display: block; /* Displayed when active */
    }

    </style>
</head>


<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="{% url 'index' %}"><img src="/staticfiles/abilityassist.png" alt="AbilityAssist Logo"
                        height="45" width="50">Ability Assist</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'index' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'about' %}">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'contact' %}">Contact</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Help</a>
                        </li>
                    </ul>
                    <div class="nav-item dropdown ml-auto">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {% if user.is_authenticated %}
                                {{ user.get_full_name|default:user.username }}
                            {% else %}
                                Login to Volunteer Account
                            {% endif %}
                            <i class="fas fa-user"></i>
                            <span class="username"></span>
                        </a>
                       <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            {% if user.is_authenticated %}
                                <a class="dropdown-item" href="{% url 'edit_profile' %}">Edit/Delete Volunteer Profile</a>
                                <a class="dropdown-item" href="{% url 'travel_history' %}">Volunteer Assist History</a>
                                <a class="dropdown-item" href="{% url 'saved_locations' %}">Assistive Resources</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'logout' %}">Log Out</a>
                            {% else %}
                                <a class="dropdown-item" href="{% url 'login' %}">Log In</a>
                                <a class="dropdown-item" href="{% url 'register' %}">Register</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="split-container">
            <div id="map-container"></div>
            <div class="form-container">
                <form id="destinationForm">
                    <div class="form-group">
                        <label for="destinationInput">Choose Destination:</label>
                        <select class="form-control" id="destinationInput">
                            <option value="">Select a destination</option>
                            <option value="Main gate">Main Gate</option>
                            <option value="Small gate">Small Gate</option>
                            <option value="Library">Library</option>
                            <option value="Building 13">Building 13</option>
                            <option value="One stop Post/Under-graduates">One-Stop Building</option>
                            <option value="I-centre">Gymnasium</option>
                            <option value="Building 14">Building 14</option>
                            <option value="Student centre">Student Centre</option>
                            <option value="Men & Femaile Resident admin">Res Admin Building</option>
                            <option value="Finanicial Aid office">Financial Aid Office</option>
                            <!-- Add more options for other landmarks -->
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Calculate Distance</button>
                </form>
                <!-- New buttons -->
                <div class="button-container d-flex flex-column align-items-center">
                    <button class="btn btn-primary chat-button" onclick="startVoiceRecognition()">
                        <i class="fas fa-microphone-alt"></i>
                        <span>Chat Instead</span> <!-- Added text -->
                        <div class="audio-indicator" id="audioIndicator">ðŸ”Š</div>
                    </button>
                    <button class="btn btn-danger emergency-button">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Contact a Volunteer</span> <!-- Added text -->
                    </button>
                </div>
                </div>
            </div>
        </div>

        <div class="company-info">
            <h2>About AbilityAssist</h2>
            <p>AbilityAssist is a company dedicated to providing assistance to people with disabilities. Our mission is to make the world more accessible and inclusive for everyone. Whether it's finding accessible routes or providing support services, we are committed to empowering individuals with disabilities.</p>
        </div>

        <div id="distanceResult" class="scroll-container mt-3"></div>
    </div>

    <footer class="mt-5">
        <div class="container">
            <p>&copy; 2024 AbilityAssist</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Google Maps JavaScript API with Places Autocomplete library -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWgNkwf11_tis-7MTs4dI-Dvm-e5EX-MA&callback=initMap&libraries=places"
        async defer></script>

     <script>
        var map;
        var tutSouthCampusBounds = {
            north: -25.5372,
            south: -25.5427,
            east: 28.0983,
            west: 28.0929
        };

        function initMap() {
            // Coordinates for Tshwane University of Technology main campus in Pretoria West
            var tutSouthCampus = { lat: -25.54055, lng: 28.095 };

            map = new google.maps.Map(document.getElementById('map-container'), {
                center: tutSouthCampus, // Center the map on TUT main campus
                zoom: 16,
                restriction: {
                latLngBounds: tutSouthCampusBounds,
                strictBounds: true
                },
            gestureHandling: 'cooperative' // Allow map panning within bounds
            });
            // Function to get the user's current location
            function getCurrentLocation() {
                // Check if the browser supports geolocation
                if (navigator.geolocation) {
                    // Use the getCurrentPosition method to get the user's location
                    navigator.geolocation.getCurrentPosition(
                        // Success callback function
                        function (position) {
                            // Get the latitude and longitude from the position object
                            const latitude = position.coords.latitude;
                            const longitude = position.coords.longitude;

                            // Log the coordinates to the console
                            console.log('Latitude:', latitude);
                            console.log('Longitude:', longitude);

<<<<<<< Updated upstream
                    // Add marker for user's current location
                    var marker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Your Location'
                    });

                    // Center the map on the user's location
                    map.setCenter(userLocation);
                }, function (error) {
                    console.error('Error: The Geolocation service failed:', error);
                }, {
                    enableHighAccuracy: true, // Request more accurate position
                    maximumAge: 5000, // Cache location for 5 seconds
                    timeout: 10000 // Wait up to 10 seconds for location response
                });
            } else {
                console.error('Error: Your browser doesn\'t support geolocation.');
=======
                            // Perform any additional actions with the coordinates
                            // For example, display them on the webpage or pass them to a map API
                            displayLocationOnMap(latitude, longitude);
                        },
                        // Error callback function
                        function (error) {
                            console.error('Error getting location:', error.message);
                        }
                    );
                } else {
                    // Geolocation is not supported by the browser
                    console.error('Geolocation is not supported by this browser.');
                }
>>>>>>> Stashed changes
            }

            // Example function to display location on a map (implementation not shown)
            function displayLocationOnMap(latitude, longitude) {
                // Implement this function to display the coordinates on a map
                // This could involve using a mapping API such as Google Maps or OpenStreetMap
                console.log('Displaying location on map...');
            }

            // Call the function to get the current location
            getCurrentLocation();

            var input = document.getElementById('destinationInput');
            var autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo('bounds', map);

            setMarkers(map);
        }

        // Data for the markers consisting of a name, a LatLng and a zIndex for the
        // order in which these markers should display on top of each other.
        const beaches = [
<<<<<<< Updated upstream
=======
          ["Student town resident admin", -25.54345, 28.09544, 14],
>>>>>>> Stashed changes
          ["Main gate", -25.54396, 28.09668, 11],
          ["Small gate",  -25.54062, 28.09766, 10],
          ["Library", -25.5403, 28.0954, 9],
          ["Building 13", -25.53922, 28.0962, 8],
          ["One stop Post/Under-graduates", -25.54055, 28.09525, 7],
          ["I-Center", -25.5403, 28.09558, 6],
          ["Building 14", -25.538888, 28.09612, 5],
          ["Gymnasium", -25.5413, 28.09568, 4],
          ["Student centre", -25.541454, 28.0951, 3],
          ["Men & Female Resident admin", -25.54025, 28.09490, 2],
          ["Financial Aid office", -25.54055, 28.0957, 1],
        ];

        function setMarkers(map) {
          // Adds markers to the map.
          // Marker sizes are expressed as a Size of X,Y where the origin of the image
          // (0,0) is located in the top left of the image.
          // Origins, anchor positions and coordinates of the marker increase in the X
          // direction to the right and in the Y direction down.
          const image = {
            url: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",
            // This marker is 20 pixels wide by 32 pixels high.
            size: new google.maps.Size(20, 32),
            // The origin for this image is (0, 0).
            origin: new google.maps.Point(0, 0),
            // The anchor for this image is the base of the flagpole at (0, 32).
            anchor: new google.maps.Point(0, 32),
          };
          // Shapes define the clickable region of the icon. The type defines an HTML
          // <area> element 'poly' which traces out a polygon as a series of X,Y points.
          // The final coordinate closes the poly by connecting to the first coordinate.
          const shape = {
            coords: [1, 1, 1, 20, 18, 20, 18, 1],
            type: "poly",
          };

          for (let i = 0; i < beaches.length; i++) {
            const beach = beaches[i];

            new google.maps.Marker({
              position: { lat: beach[1], lng: beach[2] },
              map,
              icon: image,
              shape: shape,
              title: beach[0],
              zIndex: beach[3],
            });
          }
        }

        document.getElementById('destinationForm').addEventListener('submit', function (event) {
            event.preventDefault();
            calculateDistance();
        });

        function calculateDistance() {
            var destination = document.getElementById('destinationInput').value;

            // Get user's current location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // Create a DirectionsService object
                    var directionsService = new google.maps.DirectionsService();

                    // Create a DirectionsRenderer object
                    var directionsRenderer = new google.maps.DirectionsRenderer({
                        map: map
                    });

                    // Set the options for the directions request
                    var request = {
                        origin: userLocation,
                        destination: destination,
                        travelMode: google.maps.TravelMode.WALKING // Specify walking mode
                    };

                    // Call the DirectionsService route() method to calculate the route
                    directionsService.route(request, function (response, status) {
                        if (status === 'OK') {
                            // Display the route on the map
                            directionsRenderer.setDirections(response);
                        } else {
                            // Handle error if directions request fails
                            console.error('Error calculating directions:', status);
                        }
                    });
                }, function () {
                    console.error('Error: The Geolocation service failed.');
                });
            } else {
                console.error('Error: Your browser doesn\'t support geolocation.');
            }
        }
    </script>

    <script>
    var recognition;
    var audioIndicator = document.getElementById('audioIndicator');

    function startVoiceRecognition() {
        audioIndicator.classList.add('active'); // Show audio indicator

        speak("Hello! Please choose a destination by speaking the corresponding number.");
        setTimeout(function () {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.start();
                recognition.onresult = function (event) {
                    var transcript = event.results[0][0].transcript;
                    speak("You said: " + transcript); // Speak the recognized text
                    var destinationIndex = parseInt(transcript) - 1;
                    var options = document.getElementById('destinationInput').options;
                    if (destinationIndex >= 0 && destinationIndex < options.length) {
                        options[destinationIndex].selected = true;
                        speak("Selected destination: " + options[destinationIndex].text);
                    }
                };
                recognition.onend = function () {
                    audioIndicator.classList.remove('active'); // Hide audio indicator after speech ends
                };
                setTimeout(function () {
                    recognition.stop();
                }, 7000); // Stop recognition after 5 seconds
            } else {
                alert("Speech recognition not supported in this browser!");
            }
        }, 3000); // Wait 3 seconds before starting recognition after greeting
    }

    function speak(message) {
        var speechSynthesis = window.speechSynthesis;
        var speechMessage = new SpeechSynthesisUtterance(message);
        speechSynthesis.speak(speechMessage);
    }
    </script>






</body>

</html>
